# Расширение системы

## Обзор

Система построена на конфигурации, а не хардкоде. Добавление новых типов записей не требует изменения логики.

## Как добавить новый тип записи

### Через Recipes (рекомендуется)

Просто добавьте новый Recipe в конфигурацию:
- Выберите `action` и `object` из семантического ядра
- Настройте форму (какие поля показывать)
- Настройте AI режим (если нужно)

**Всё!** Никаких изменений в коде не требуется.

### Через код (для legacy поддержки)

Если нужно добавить новый EntryType для обратной совместимости:

1. Добавить тип в enum EntryType
2. Добавить маппинг EntryType → Action + Object
3. Добавить обратный маппинг Action + Object → EntryType
4. Добавить в Recipe конфигурацию

## 2. Автоматический парсинг

Система автоматически парсит типы формата `category.subtype`:

- `category` → определяет `object`
- `subtype` → определяет `action`

Примеры:
- `money.expense` → `{ action: 'spent', object: 'money' }`
- `item.lent` → `{ action: 'lent', object: 'item' }`

Если тип не найден в конфигурации, система попытается автоматически определить семантику.

## 3. Расширение AI промпта

AI промпт генерируется динамически на основе:
- Доступных действий (actions)
- Доступных объектов (objects)
- Типов записей из модулей

При добавлении нового типа AI автоматически получит информацию о нем.

## Автоматические функции

Система предоставляет функции для работы с семантикой:
- Конвертация EntryType → Action + Object
- Конвертация Action + Object → EntryType
- Получение типов по объекту или действию
- Генерация AI промптов на основе Recipes

## Пример: Добавление нового типа "Поездка"

**Через Recipe (рекомендуется):**
- Action: `visited`
- Object: `place`
- Label: "Поездка"
- Форма: title, date, placeText, tags, attachments
- AI: режим `place_photo`

**Через код (legacy):**
- Добавить EntryType `trip.visited`
- Маппинг: `trip.visited` → `{ action: 'visited', object: 'place' }`
- Добавить в Recipe конфигурацию

## 6. Принципы масштабируемости

1. **Конфигурация > Код**: Все маппинги в конфигурации
2. **Автоматический парсинг**: Система пытается определить семантику автоматически
3. **Fallback**: Если тип не найден → `noted + note`
4. **Расширяемость**: Новые типы не требуют изменения логики

## 7. Проверка валидности

Используйте `isValidEntryType(type: string)` для проверки валидности типа.

