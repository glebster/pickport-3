## Лог сессии

### 2026-01-13
- Добавлен клиентский модуль кеширования черновиков с лимитом на 20 записей и обработкой ошибок при чтении/записи.
- В ленте `/entries` добавлена секция локальных черновиков с кнопкой продолжения в `/new` через `preselect`.
- Добавлено серверное кеширование схемы с повторным запросом после ошибок при загрузке стартового экрана.
- В интерфейсе отображается версия схемы даже при сетевой ошибке, с пометкой использования кеша.
- В настройках добавлен блок локального хранилища с отображением размера черновиков и кнопкой очистки, подключены клиентские методы для работы с черновиками.
- Сверены `docs/02-plan.md` и `docs/08-roadmap.md`; статус G2 обновлён на «В работе».

### 2026-01-12
- Разделены AI-поиск и чат: добавлены маршруты `/search` и `/bot`, обновлён `AppShell`, переделаны UI-блоки для каждого сценария.
- Подготовлен дизайн-бриф `docs/09-ai-ui-brief.md` и добавлена ссылка в `docs/00-index.md` для генеративных инструментов.

### 2026-01-11
- Добавлен обзорный документ `docs/10-entities.md` с основными сущностями, полями и AI/уведомлениями.
- Переписан `docs/10-entities.md` на ясную структуру: описание сущностей, связи, поля с типами/JSONB и AI-мета; унифицированы названия в одно слово (memberships, pairs, attachments, insights, formsets, toggles, versions, syncs и др.).
- Добавлен компактный слой кастомизаций `extensions` (одно хранилище для полей/категорий/пар) в `docs/10-entities.md`.
- Добавлен health-эндпоинт `/api/v1/health` с проверками Redis/Celery и тестами.
- Обновлены скрипты и типы схем для фронтенда, а формы `/new` и `/entries` теперь используют сгенерированные типы.
- Добавлен каркас синхронизации: новый эндпоинт `GET /api/v1/sync/state`, базовый ответ и подключение роутера; документация API обновлена.
- Добавлен IndexedDB-клиент для списка черновиков и очистки, а на `/entries` выведен локальный список черновиков с датой обновления и summary.
- Зафиксирован 2-шаговый сценарий визарда новой записи (Capture + AI Draft/Review) в UI-брифе.
- Уточнены детали AI-парсинга, примеры структурированного описания и UX редактирования полей в UI-брифе.
- Архивированы старые фронтенд-макеты, а для основных роутов собран новый mobile-first UI на Svelte 5 по мотивам lovable (без shadcn-карточек, с собственными поверхностями).
- Зафиксировано завершение CRUD по `/api/v1/entries` и смещение G1 на тесты, миграции и CI.
- Уточнены публичные параметры `/api/v1/entries`, добавлена документация по фильтрам.
- Актуализированы дорожная карта и журнал.
- Лента `/entries` теперь рендерит данные из backend и показывает состояния загрузки, пустого списка и ошибки.
- В статусах ленты учтены backend-значения `draft/confirmed/archived` для правильных бейджей.
- Даты в списке `/entries` форматируются под русскую локаль.
- Форматирование дат учитывает значения `YYYY-MM-DD` без сдвигов по таймзоне.
- В `/entries` добавлены серверные фильтры по статусу, категории и диапазону дат.
- Карточка записи `/entry/[id]` подтянута к backend и связана ссылками из ленты.
- Экран `/new` получил форму быстрого создания записи, чтобы проверить полный цикл «создал → увидел в карточке».
- На `/new` дата нормализуется в ISO и передаётся в черновик, если поле заполнено.
- Добавлено сохранение черновика новой записи в IndexedDB с восстановлением состояния на шаге деталей.
- Обновлена метка времени сохранения черновика в визарде новой записи.
- Ограничено автосохранение черновика после восстановления, чтобы не затирать время сохранения.

### 2026-01-10
- Починен фронтенд после `svelte-check`: `PUBLIC_BACKEND_URL` берётся через `$env/dynamic/public`, страницы `/` и `/entries` переведены на `$props`, select-обёртка поддерживает одиночный режим по умолчанию, а `npm run check` снова зелёный.
- Обновлены onboarding и визард новой записи под мобильный UX (экраны-шага, фиксированные действия).
- Добавлены блоки напоминаний и настройки уведомлений в макетах (новая запись, карточка, настройки).
- Переработан верхний бар не главных экранов под mobile-паттерны (title + back/close).
- Пересобран стартовый экран и расширены черновики UI под PWA-сценарий (плавающая кнопка `+`, стартовые переходы, AI чат).
- Создан комплект черновиков экранов (dashboard, entries, entry detail, `/new`, search/AI, settings, onboarding) на Svelte 5 + shadcn-svelte.
- Собран финальный мобильный dashboard (`/`): App Bar с двумя экшенами, greeting, conditional reminder, quick actions, preview трёх записей, один AI-инсайт, горизонтальные фильтры и FAB.
- Прочитан `docs/app-overview.md`, созданы `docs/01-ponyal.md` и `docs/02-plan.md`, добавлен `docs/03-pipeline.md`.
- Зафиксированы каналы ввода (текст/фото/URL/рецепт), PWA-only и schema-first подходы; обновлены план и roadmap (`docs/08-roadmap.md`).
- Созданы JSON Schema (`entry-draft`, `entry`) и helper `getEntrySchemas()`; фронтенд умеет тянуть `/api/config/entry-schema`.
- Обновлены `docs/app-overview.md` и `docs/architecture-api.md` под стек SvelteKit 5 + FastAPI + PostgreSQL/Redis/Celery.
- Инициализирован backend (репо, Alembic, Dockerfile, docker-compose, README), настроена генерация типов из `common/schemas`.
- Добавлены конспекты `docs/06-shadcn-svelte.md` и `docs/07-shadcn-theming.md`.
- Реализован `/api/v1/config/entry-schema`, настроены миграции, CI и тесты (`entries`, health, includeDeleted, schema version).
- Обновлён `pyproject.toml`, Dockerfile/compose; добавлен frontend сервис и автозапуск миграций.
- Добавлена таблица `users`, сидер `admin@pickpock.ru`, CRUD `/api/v1/entries`, страница `/entries` на фронте.
- В CI включены миграции, pytest, линтер `ruff`, скрипт проверки расхождений моделей; отмечено завершение этапа G1.
- Фронтенд отображает версию схемы на стартовом экране, docker окружение доведено до рабочего состояния.
- На экране создания записи добавлен индикатор статуса сохранения черновика рядом с таймстампом.

> Формат: на каждый новый день добавляем секцию `### YYYY-MM-DD` и перечисляем действия.
